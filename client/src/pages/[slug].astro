---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import SectionHeading from "../components/SectionHeading.astro";
import CardGrid from "../components/CardGrid.astro";
import ContentWithImage from "../components/ContentWithImage.astro";
import MarkdownBlock from "../components/MarkdownBlock.astro";
import PersonCard from "../components/PersonCard.astro";
import FaqSection from "../components/FaqSection.astro";
import Newsletter from "../components/Newsletter.astro";
import FeaturedArticles from "../components/FeaturedArticles.astro";

// ✅ Type your Strapi block
type StrapiBlock = {
	__component: string;
	id: number;
	heading?: string;
	text?: string;
	links?: any[];
	image?: {
		url: string;
		alternativeText?: string;
	};
};

// ✅ Type your page
type StrapiPage = {
	id: number;
	title: string;
	description: string;
	slug: string;
	blocks: StrapiBlock[];
};

// ✅ 1. Get all slugs
export async function getStaticPaths() {
	const res = await fetch("http://127.0.0.1:1337/api/pages");
	const json = await res.json();

	return json.data.map((page: any) => ({
		params: { slug: page.slug },
		props: { page },
	}));
}

// ✅ 2. Access props and safely type them
const { page } = Astro.props as { page: StrapiPage };
const { title, description, blocks } = page;
---

<Layout>
	<main class="bg-white text-gray-900 antialiased">
		<section class="container mx-auto px-6 py-16 text-center">
			<h1 class="text-5xl font-extrabold text-gray-800 mb-4">{title}</h1>
			<p class="text-lg text-gray-600">{description}</p>
		</section>

		{
			blocks?.map((block) => (
				<>
					{block.__component === "blocks.hero" && <Hero block={block} />}
					{block.__component === "blocks.section-heading" && (
						<SectionHeading block={block} />
					)}
					{block.__component === "blocks.card-grid" && (
						<CardGrid block={block} />
					)}
					{block.__component === "blocks.content-with-image" && (
						<ContentWithImage block={block} />
					)}
					{block.__component === "blocks.markdown" && (
						<MarkdownBlock block={block} />
					)}
					{block.__component === "blocks.person-card" && (
						<PersonCard block={block} />
					)}
					{block.__component === "blocks.faqs" && (
						<FaqSection block={block} />
					)}
					{block.__component === "blocks.newsletter" && (
						<Newsletter block={block} />
					)}
					{block.__component === "blocks.featured-articles" && (
						<FeaturedArticles block={block} />
					)}
				</>
			))
		}
	</main>
</Layout>
